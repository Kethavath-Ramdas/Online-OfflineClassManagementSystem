<!DOCTYPE html>
<html>
<head>
    <title>Attendance History</title>
    <link rel="stylesheet" href="/css/register.css">
</head>
<body>
<div class="register-wrapper">
    <div class="left-panel">
        <h1>History</h1>
        <p>Attendance history</p>
    </div>
    <div class="right-panel">
        <h2>Attendance History</h2>
        <table border="1" width="100%">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>User ID</th>
                    <th>Class ID</th>
                    <th>Class Type</th>
                    <th>Status</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="attendanceTable"></tbody>
        </table>
        <p><a href="/dashboard">â¬… Back to Dashboard</a></p>
    </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const token = localStorage.getItem("token");
    console.log("TOKEN:", token);
    if (!token) {
        alert("Session expired");
        window.location.href = "/";
        return;
    }
    const userId = 1;
    fetch(`/attendance/history?userId=${userId}`, {
        method: "GET",
        headers: {
            "Authorization": "Bearer " + token,
            "Accept": "application/json"
        }
    })
    .then(response => {
        console.log("HTTP STATUS:", response.status);

        if (!response.ok) {
            throw new Error("HTTP error " + response.status);
        }

        return response.json();   
    })
    .then(response => {
        console.log("FULL RESPONSE:", response);
        console.log("DATA ARRAY:", response.data);

        if (!response.data || response.data.length === 0) {
            alert("No attendance records found");
            return;
        }
        const tbody = document.getElementById("attendanceTable");
        tbody.innerHTML = "";
        response.data.forEach(a => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${a.id}</td>
                <td>${a.userId}</td>
                <td>${a.classId}</td>
                <td>${a.classType}</td>
                <td>${a.status}</td>
                <td>${a.attendanceDate}</td>
            `;

            tbody.appendChild(row);
        });
    })
    .catch(err => {
        console.error("FETCH ERROR:", err);
        alert("Failed to load attendance history");
    });
});
</script>

</body>
</html>
