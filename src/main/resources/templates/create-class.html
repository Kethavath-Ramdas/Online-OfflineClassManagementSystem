<!DOCTYPE html>
<html>
<head>
    <title>Create Class</title>
    <link rel="stylesheet" href="/css/register.css">
</head>
<body>

<div class="register-wrapper">
    <div class="left-panel">
        <h1>Create Class</h1>
        <p>Add online or offline class details</p>
    </div>

    <div class="right-panel">
        <h2>Class Details</h2>

        <!-- CLASS TYPE -->
        <select id="classType">
            <option value="">Select Class Type</option>
            <option value="ONLINE">ONLINE</option>
            <option value="OFFLINE">OFFLINE</option>
        </select>

        <!-- MEETING LINK -->
        <input type="text" id="meetingLink" placeholder="Meeting Link (Online)" />

        <!-- CLASSROOM -->
        <input type="text" id="classroom" placeholder="Classroom (Offline)" />

        <!-- CLASS DATE -->
        <input type="date" id="classDate" />

        <!-- ✅ CLASS TIME -->
        <input type="time" id="classTime" />

        <button onclick="createClass()">Create</button>

        <p><a href="/dashboard">⬅ Back to Dashboard</a></p>
    </div>
</div>

<script>
function createClass() {

    const token = localStorage.getItem("token");

    if (!token) {
        alert("Session expired. Please login again.");
        window.location.href = "/";
        return;
    }

    const rawTime = document.getElementById("classTime").value;

    if (!rawTime) {
        alert("Please select class time");
        return;
    }

    // convert 24hr → AM/PM
    function formatTime(time) {
        const [hour, minute] = time.split(":");
        let h = parseInt(hour);
        const ampm = h >= 12 ? "PM" : "AM";
        h = h % 12 || 12;
        return `${h}:${minute} ${ampm}`;
    }

    const data = {
        classType: document.getElementById("classType").value,
        meetinglink: document.getElementById("meetingLink").value,
        classroom: document.getElementById("classroom").value,
        classDate: document.getElementById("classDate").value,
        time: formatTime(rawTime)   // ✅ STRING STORED
    };

    console.log("Creating class:", data);

    fetch("/class/create", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify(data)
    })
    .then(res => {
        if (res.status === 403) {
            alert("Unauthorized. Please login again.");
            window.location.href = "/";
            return;
        }
        return res.json();
    })
    .then(result => {
        console.log("Saved:", result);
        alert("Class created successfully");
        window.location.href = "/dashboard";
    })
    .catch(err => {
        console.error(err);
        alert("Error creating class");
    });
}
</script>

</body>
</html>
